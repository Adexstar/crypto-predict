<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Option Payoff - Investment Prediction</title>
  <link rel="stylesheet" href="css/dashboard.css">
  <link rel="stylesheet" href="css/style.css">
  <style>
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .card { background: #1a1a2e; border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 8px; padding: 20px; margin-bottom: 20px; }
    .card-title { color: #f0ad4e; font-size: 1.3rem; font-weight: 700; margin-bottom: 15px; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; color: #a1a1a9; font-weight: 600; margin-bottom: 8px; }
    .form-group input { width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); border-radius: 6px; color: #e4e4e7; font-size: 1rem; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
    @media (max-width: 768px) {
      .grid-2, .grid-3 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header class="header" id="app-header"></header>
  
  <main class="container">
    <div class="card">
      <div class="card-title">ðŸ“ˆ Option Payoff Diagram Calculator</div>
      
      <div class="grid-3">
        <div class="form-group">
          <label for="strike-price">Strike Price ($)</label>
          <input type="number" id="strike-price" value="100" min="1" step="1">
        </div>
        
        <div class="form-group">
          <label for="premium">Premium ($)</label>
          <input type="number" id="premium" value="5" min="0" step="0.5">
        </div>
        
        <div class="form-group">
          <label for="option-type">Option Type</label>
          <select id="option-type" style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); border-radius: 6px; color: #e4e4e7; cursor: pointer;">
            <option value="call">Call</option>
            <option value="put">Put</option>
          </select>
        </div>
      </div>

      <div style="margin-top: 30px; text-align: center;">
        <canvas id="payoff-chart" style="max-width: 100%; height: auto;"></canvas>
      </div>

      <div style="margin-top: 20px; padding: 15px; background: rgba(240, 173, 78, 0.1); border: 1px solid rgba(240, 173, 78, 0.3); border-radius: 8px;">
        <div style="color: #a1a1a9; font-size: 0.9rem; margin-bottom: 8px;">Breakeven Price</div>
        <div style="color: #f0ad4e; font-size: 1.4rem; font-weight: 700;" id="breakeven">$105.00</div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">ðŸ“š Option Payoff Concepts</div>
      <div style="color: #e4e4e7; line-height: 1.8;">
        <p style="margin-bottom: 15px;">
          <strong style="color: #f0ad4e;">Call Option:</strong> Right to buy at strike price. Profitable when stock price > strike + premium.
        </p>
        <p style="margin-bottom: 15px;">
          <strong style="color: #f0ad4e;">Put Option:</strong> Right to sell at strike price. Profitable when stock price < strike - premium.
        </p>
        <p style="margin-bottom: 15px;">
          <strong style="color: #f0ad4e;">Breakeven Point:</strong> Stock price where your total profit/loss equals zero, accounting for premium paid.
        </p>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module">
    import { getCurrentUser } from './js/userData.js';

    let chart = null;

    function initPage() {
      const user = getCurrentUser();
      if (!user) {
        window.location.href = 'login.html';
        return;
      }

      // Render header
      const header = document.getElementById('app-header');
      header.innerHTML = `
        <div class="brand">
          <div class="logo">Î£</div>
          <div>
            <div class="brand-title">INVEST</div>
            <div class="brand-subtitle">Dashboard</div>
          </div>
        </div>
        <div class="nav">
          <span class="sandbox-badge">DATA FEED</span>
          <a href="landing.html" class="nav-link">Landing</a>
          <a href="deposit.html" class="nav-link">Deposit</a>
          <a href="withdraw.html" class="nav-link">Withdraw</a>
          <a href="transfer.html" class="nav-link">Transfer</a>
          <a href="history.html" class="nav-link">History</a>
          <a href="profile.html" class="nav-link">Profile</a>
          <a href="settings.html" class="nav-link">Settings</a>
          <a href="reset.html" class="nav-link">Reset Password</a>
        </div>
      `;

      function calculatePayoff() {
        const strikePrice = parseFloat(document.getElementById('strike-price').value) || 100;
        const premium = parseFloat(document.getElementById('premium').value) || 5;
        const optionType = document.getElementById('option-type').value;

        const prices = [];
        const payoffs = [];

        for (let S = Math.max(0, strikePrice - 50); S <= strikePrice + 50; S += 1) {
          prices.push(S);
          
          let payoff;
          if (optionType === 'call') {
            payoff = Math.max(0, S - strikePrice) - premium;
          } else {
            payoff = Math.max(0, strikePrice - S) - premium;
          }
          payoffs.push(payoff);
        }

        const breakeven = optionType === 'call' ? strikePrice + premium : strikePrice - premium;
        document.getElementById('breakeven').textContent = '$' + breakeven.toFixed(2);

        const ctx = document.getElementById('payoff-chart').getContext('2d');
        
        if (chart) {
          chart.destroy();
        }

        chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: prices,
            datasets: [{
              label: optionType.charAt(0).toUpperCase() + optionType.slice(1) + ' Payoff',
              data: payoffs,
              borderColor: '#f0ad4e',
              backgroundColor: 'rgba(240, 173, 78, 0.1)',
              borderWidth: 2,
              tension: 0.4,
              fill: true,
              pointRadius: 0
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: true,
                labels: { color: '#e4e4e7' }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                ticks: { color: '#a1a1a9' }
              },
              x: {
                title: { display: true, text: 'Stock Price ($)', color: '#e4e4e7' },
                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                ticks: { color: '#a1a1a9' }
              }
            }
          }
        });
      }

      document.getElementById('strike-price').addEventListener('input', calculatePayoff);
      document.getElementById('premium').addEventListener('input', calculatePayoff);
      document.getElementById('option-type').addEventListener('change', calculatePayoff);
      
      calculatePayoff();
    }

    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initPage);
    } else {
      initPage();
    }
  </script>
</body>
</html>
